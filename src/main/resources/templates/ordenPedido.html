<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orden Pedido - AkiraComputer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link th:href="@{/css/styles.css}" rel="stylesheet">
</head>
<body>
    <!-- Include Header -->
    <div th:replace="~{header :: header}"></div>

    <!-- Orden Pedido Section -->
    <section class="orden-section">
        <div class="container">
            <h1 class="orden-title">ORDEN PEDIDO</h1>
            
            <!-- Search Bar Mejorada -->
            <div class="search-container">
                <label class="search-label">Buscar</label>
                <input type="text" class="search-input" placeholder="Código de pedido o DNI del cliente..." autocomplete="off">
                <button class="search-btn" title="Buscar">
                    <i class="fas fa-search"></i>
                </button>
                <button class="search-btn clear-btn" title="Limpiar búsqueda" style="display: none;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Contenedor de resultados de búsqueda -->
            <div id="searchResults" class="search-results-container" style="display: none;"></div>
            
            <!-- Alerts Container -->
            <div id="alertContainer"></div>
            
            <!-- Orden Table -->
            <div class="orden-table">
                <table class="table table-bordered mb-0">
                    <thead>
                        <tr>
                            <th>Código Pedido</th>
                            <th>Cliente</th>
                            <th>Dni</th>
                            <th>Fecha de pago</th>
                            <th>Total</th>
                            <th>Estado de Atención</th>
                            <th>Técnico Asignado</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
					<tbody id="ordenesTableBody">
					    <tr th:each="orden : ${ordenes}">
					        <td th:text="${orden.codigo}"></td>
					        <td th:text="${orden.cliente != null ? orden.cliente.nombre + ' ' + orden.cliente.apellido : 'Sin cliente'}"></td>
					        <td th:text="${orden.cliente != null ? orden.cliente.dni : 'Sin DNI'}"></td>
					        <td th:text="${#temporals.format(orden.fecha, 'dd/MM/yyyy')}"></td>
					        <td th:text="'S/ ' + ${#numbers.formatDecimal(orden.total, 0, 2)}"></td>
					        <td th:text="${orden.estado.descripcion}" 
					            th:class="${orden.estado.descripcion == 'Pendiente' ? 'estado-pendiente' : 'estado-atendido'}"></td>
					        
					        <!-- LÓGICA CORREGIDA: Solo mostrar técnico si el estado es 'Atendido' -->
					        <td th:text="${orden.estado.descripcion == 'Atendido' and orden.tecnico != null ? 
					                      orden.tecnico.nombre + ' ' + orden.tecnico.apellido : 'Sin asignar'}" 
					            th:class="${orden.estado.descripcion == 'Atendido' and orden.tecnico != null ? '' : 'text-muted'}"></td>
					        
					        <td class="action-cell">
					            <button class="btn-edit" th:onclick="'editarOrden(' + ${orden.codigo} + ')'" title="Editar">
					                <i class="fas fa-edit"></i>
					            </button>
					        </td>
					    </tr>
					    
					    <tr th:if="${#lists.isEmpty(ordenes)}">
					        <td colspan="8" style="text-align: center;">No hay órdenes de pedido</td>
					    </tr>
					</tbody>
                </table>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-generar" onclick="abrirModalGenerarPedido()">
                    <i class="fas fa-plus me-2"></i>GENERAR ORDEN PEDIDO
                </button>
                <button class="btn btn-asignar" onclick="abrirModalAsignar()">
                    <i class="fas fa-user-check me-2"></i>ASIGNAR PEDIDO
                </button>
            </div>
        </div>
    </section>
	
	<!-- Modal de Generación de Pedido MODIFICADO (sin registro de pago) -->
	<!-- Modal Generar Pedido Mejorado -->
	<div class="modal fade" id="generarPedidoModal" tabindex="-1" aria-labelledby="generarPedidoModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-xl">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="generarPedidoModalLabel">
	                    <i class="fas fa-plus me-2"></i>Generar Nueva Orden de Pedido
	                </h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            
	            <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
	                <!-- Alertas del modal -->
	                <div id="generarModalAlertContainer"></div>
	                
	                <!-- PASO 1: SELECCIÓN DE CLIENTE -->
	                <div class="mb-4">
	                    <h6 class="text-primary mb-3">
	                        <i class="fas fa-user me-2"></i>Paso 1: Seleccionar Cliente
	                    </h6>
	                    
	                    <!-- Búsqueda de cliente -->
	                    <div class="row mb-3">
	                        <div class="col-md-8">
	                            <label class="form-label">Buscar cliente por nombre, apellido o DNI</label>
	                            <div class="input-group">
	                                <input type="text" class="form-control" id="clienteBuscar" 
	                                       placeholder="Ingrese nombre, apellido o DNI para buscar...">
	                                <button class="btn btn-outline-secondary" type="button" onclick="buscarClientes()">
	                                    <i class="fas fa-search"></i>
	                                </button>
	                            </div>
	                        </div>
	                        <div class="col-md-4">
	                            <label class="form-label">&nbsp;</label>
	                            <button class="btn btn-success w-100" onclick="abrirModalRegistrarCliente()">
	                                <i class="fas fa-plus me-1"></i>Nuevo Cliente
	                            </button>
	                        </div>
	                    </div>
	                    
	                    <!-- Resultados de búsqueda de clientes -->
	                    <div id="clienteResultados" class="border rounded p-3 mb-3" style="display: none;">
	                        <!-- Se llenarán dinámicamente con JavaScript -->
	                    </div>
	                    
	                    <!-- Cliente seleccionado -->
	                    <div id="clienteSeleccionadoInfo" class="alert alert-success" style="display: none;">
	                        <!-- Se llenará dinámicamente con JavaScript -->
	                    </div>
	                </div>
	                
	                <!-- PASO 2: TIPO DE PEDIDO -->
	                <div class="mb-4" id="seccionTipoPedido" style="display: none;">
	                    <h6 class="text-primary mb-3">
	                        <i class="fas fa-list me-2"></i>Paso 2: Tipo de Pedido
	                    </h6>
	                    
	                    <div class="row">
	                        <div class="col-md-6">
	                            <div class="card h-100 tipo-pedido-card" onclick="seleccionarTipoPedido('PRODUCTO_COMPLETO')">
	                                <div class="card-body text-center">
	                                    <i class="fas fa-box fa-3x text-info mb-3"></i>
	                                    <h5 class="card-title">Producto Completo</h5>
	                                    <p class="card-text text-muted">
	                                        Seleccionar productos individuales del inventario
	                                    </p>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="col-md-6">
	                            <div class="card h-100 tipo-pedido-card" onclick="seleccionarTipoPedido('ARMAR_PC')">
	                                <div class="card-body text-center">
	                                    <i class="fas fa-desktop fa-3x text-warning mb-3"></i>
	                                    <h5 class="card-title">Armar PC</h5>
	                                    <p class="card-text text-muted">
	                                        Seleccionar componentes por categoría para armar una PC
	                                    </p>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                    
	                    <!-- Indicador del tipo seleccionado -->
	                    <div id="tipoSeleccionadoInfo" class="alert alert-info mt-3" style="display: none;">
	                        <!-- Se llenará dinámicamente -->
	                    </div>
	                </div>
	                
	                <!-- PASO 3A: PRODUCTOS COMPLETOS -->
	                <div class="mb-4" id="seccionProductosCompletos" style="display: none;">
	                    <h6 class="text-primary mb-3">
	                        <i class="fas fa-shopping-cart me-2"></i>Paso 3: Seleccionar Productos
	                    </h6>
	                    
	                    <!-- Búsqueda de productos -->
	                    <div class="row mb-3">
	                        <div class="col-md-4">
	                            <label class="form-label">Buscar por código</label>
	                            <div class="input-group">
	                                <input type="number" class="form-control" id="productoCodigo" 
	                                       placeholder="Código del producto">
	                                <button class="btn btn-outline-secondary" onclick="buscarProductoPorCodigo()">
	                                    <i class="fas fa-search"></i>
	                                </button>
	                            </div>
	                        </div>
	                        <div class="col-md-4">
	                            <label class="form-label">Buscar por nombre</label>
	                            <div class="input-group">
	                                <input type="text" class="form-control" id="productoNombre" 
	                                       placeholder="Nombre del producto">
	                                <button class="btn btn-outline-secondary" onclick="buscarProductosPorNombre()">
	                                    <i class="fas fa-search"></i>
	                                </button>
	                            </div>
	                        </div>
	                        <div class="col-md-4">
	                            <label class="form-label">Filtrar por categoría</label>
	                            <select class="form-control" id="categoriaFiltro" onchange="buscarProductosPorCategoria()">
	                                <option value="">Todas las categorías</option>
	                                <!-- Se llenarán dinámicamente -->
	                            </select>
	                        </div>
	                    </div>
	                    
	                    <!-- Resultados de productos -->
	                    <div id="productosResultados" class="row" style="display: none;">
	                        <!-- Se llenarán dinámicamente -->
	                    </div>
	                    
	                    <!-- Productos seleccionados -->
	                    <div class="mt-4">
	                        <h6>Productos Seleccionados</h6>
	                        <div class="table-responsive">
	                            <table class="table table-sm">
	                                <thead class="table-light">
	                                    <tr>
	                                        <th>Código</th>
	                                        <th>Producto</th>
	                                        <th>Precio Unit.</th>
	                                        <th>Cantidad</th>
	                                        <th>Subtotal</th>
	                                        <th>Acciones</th>
	                                    </tr>
	                                </thead>
	                                <tbody id="productosSeleccionadosTable">
	                                    <tr>
	                                        <td colspan="6" class="text-center text-muted">No hay productos seleccionados</td>
	                                    </tr>
	                                </tbody>
	                            </table>
	                        </div>
	                    </div>
	                </div>
	                
	                <!-- PASO 3B: ARMAR PC -->
	                <div class="mb-4" id="seccionArmarPC" style="display: none;">
	                    <h6 class="text-primary mb-3">
	                        <i class="fas fa-microchip me-2"></i>Paso 3: Seleccionar Componentes para PC
	                    </h6>
	                    
	                    <!-- Acordeón de categorías -->
	                    <div class="accordion" id="categoriasAccordion">
	                        <!-- Se llenarán dinámicamente con las categorías -->
	                    </div>
	                    
	                    <!-- Resumen de componentes seleccionados -->
	                    <div class="mt-4">
	                        <h6>Componentes Seleccionados</h6>
	                        <div class="table-responsive">
	                            <table class="table table-sm">
	                                <thead class="table-light">
	                                    <tr>
	                                        <th>Categoría</th>
	                                        <th>Componente</th>
	                                        <th>Modelo</th>
	                                        <th>Precio</th>
	                                        <th>Acciones</th>
	                                    </tr>
	                                </thead>
	                                <tbody id="componentesSeleccionadosTable">
	                                    <tr>
	                                        <td colspan="5" class="text-center text-muted">No hay componentes seleccionados</td>
	                                    </tr>
	                                </tbody>
	                            </table>
	                        </div>
	                    </div>
	                </div>
	                
	                <!-- RESUMEN Y TOTALES -->
	                <div class="row mt-4" id="seccionResumen" style="display: none;">
	                    <div class="col-md-8">
	                        <div class="card">
	                            <div class="card-header">
	                                <h6 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Resumen del Pedido</h6>
	                            </div>
	                            <div class="card-body">
	                                <div class="row">
	                                    <div class="col-6">
	                                        <strong>Cliente:</strong><br>
	                                        <span id="resumenCliente">-</span>
	                                    </div>
	                                    <div class="col-6">
	                                        <strong>Tipo de Pedido:</strong><br>
	                                        <span id="resumenTipo">-</span>
	                                    </div>
	                                </div>
	                                <hr>
	                                <div class="row">
	                                    <div class="col-6">
	                                        <strong>Total de Items:</strong><br>
	                                        <span id="resumenCantidad">0</span>
	                                    </div>
	                                    <div class="col-6">
	                                        <strong>Monto Total:</strong><br>
	                                        <span class="h5 text-success">S/ <span id="resumenTotal">0.00</span></span>
	                                    </div>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                    <div class="col-md-4">
	                        <div class="d-grid gap-2">
	                            <button class="btn btn-success btn-lg" id="btnGenerarPedido" onclick="generarPedido()" disabled>
	                                <i class="fas fa-plus-circle me-2"></i>Generar Orden de Pedido
	                            </button>
	                            <button class="btn btn-outline-secondary" onclick="limpiarFormulario()">
	                                <i class="fas fa-broom me-2"></i>Limpiar Formulario
	                            </button>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>

	<!-- Modal para registrar nuevo cliente -->
	<div class="modal fade" id="registrarClienteModal" tabindex="-1">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title">
	                    <i class="fas fa-user-plus me-2"></i>Registrar Nuevo Cliente
	                </h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
	            </div>
	            <div class="modal-body">
	                <div id="registrarClienteModalAlertContainer"></div>
	                
	                <div class="row">
	                    <div class="col-md-6">
	                        <div class="mb-3">
	                            <label class="form-label">DNI/RUC *</label>
	                            <input type="text" class="form-control" id="registroDni" 
	                                   placeholder="8 dígitos para DNI, 11 para RUC" maxlength="11">
	                        </div>
	                        <div class="mb-3">
	                            <label class="form-label">Nombre *</label>
	                            <input type="text" class="form-control" id="registroNombre" 
	                                   placeholder="Nombre del cliente">
	                        </div>
	                        <div class="mb-3">
	                            <label class="form-label">Apellido</label>
	                            <input type="text" class="form-control" id="registroApellido" 
	                                   placeholder="Apellido del cliente">
	                        </div>
	                    </div>
	                    <div class="col-md-6">
	                        <div class="mb-3">
	                            <label class="form-label">Correo</label>
	                            <input type="email" class="form-control" id="registroCorreo" 
	                                   placeholder="cliente@email.com">
	                        </div>
	                        <div class="mb-3">
	                            <label class="form-label">Teléfono</label>
	                            <input type="text" class="form-control" id="registroTelefono" 
	                                   placeholder="999999999">
	                        </div>
	                        <div class="mb-3">
	                            <label class="form-label">Dirección</label>
	                            <textarea class="form-control" id="registroDireccion" rows="2" 
	                                      placeholder="Dirección del cliente"></textarea>
	                        </div>
	                    </div>
	                </div>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
	                <button type="button" class="btn btn-primary" id="btnGuardarCliente" onclick="registrarNuevoCliente()">
	                    <i class="fas fa-save me-1"></i>Registrar Cliente
	                </button>
	            </div>
	        </div>
	    </div>
	</div>

	<!-- Modal de Registro de Cliente -->
	<div class="modal fade" id="registrarClienteModal" tabindex="-1" aria-labelledby="registrarClienteModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-lg">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="registrarClienteModalLabel">
	                    <i class="fas fa-user-plus me-2"></i>Registrar Nuevo Cliente
	                </h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <div class="modal-body">
	                
	                <!-- Alertas del modal -->
	                <div id="registrarClienteModalAlertContainer"></div>
	                
	                <form id="formRegistrarCliente">
	                    <div class="row">
	                        <div class="col-md-6">
	                            <div class="mb-3">
	                                <label for="clienteNuevoDni" class="form-label">DNI <span class="text-danger">*</span></label>
	                                <input type="text" class="form-control" id="clienteNuevoDni" 
	                                       placeholder="DNI (8 dígitos)" required readonly maxlength="8">
	                                <small class="text-muted">Este campo se completa automáticamente</small>
	                            </div>
	                        </div>
	                        <div class="col-md-6">
	                            <div class="mb-3">
	                                <label for="clienteNuevoNombre" class="form-label">Nombre Completo <span class="text-danger">*</span></label>
	                                <input type="text" class="form-control" id="clienteNuevoNombre" 
	                                       placeholder="Nombre completo del cliente" required>
	                            </div>
	                        </div>
	                    </div>
	                    
	                    <div class="row">
	                        <div class="col-md-6">
	                            <div class="mb-3">
	                                <label for="clienteNuevoTelefono" class="form-label">Teléfono <span class="text-danger">*</span></label>
	                                <input type="tel" class="form-control" id="clienteNuevoTelefono" 
	                                       placeholder="Número de teléfono" required>
	                            </div>
	                        </div>
	                        <div class="col-md-6">
	                            <div class="mb-3">
	                                <label for="clienteNuevoCorreo" class="form-label">Correo Electrónico <span class="text-danger">*</span></label>
	                                <input type="email" class="form-control" id="clienteNuevoCorreo" 
	                                       placeholder="correo@ejemplo.com" required>
	                            </div>
	                        </div>
	                    </div>
	                    
	                    <!-- Campo de Razón Social eliminado -->
	                    
	                    <div class="row">
	                        <div class="col-12">
	                            <div class="mb-3">
	                                <label for="clienteNuevaDireccion" class="form-label">Dirección</label>
	                                <textarea class="form-control" id="clienteNuevaDireccion" rows="2" 
	                                          placeholder="Dirección completa del cliente"></textarea>
	                            </div>
	                        </div>
	                    </div>
	                </form>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
	                    <i class="fas fa-times me-2"></i>Cancelar
	                </button>
	                <button type="button" class="btn btn-primary" onclick="guardarNuevoCliente()" id="btnGuardarCliente">
	                    <i class="fas fa-save me-2"></i>Registrar Cliente
	                </button>
	            </div>
	        </div>
	    </div>
	</div>
	
	<!-- Modal de Registro de Pago - INDEPENDIENTE -->
	<div class="modal fade" id="registrarPagoModal" tabindex="-1" aria-labelledby="registrarPagoModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-lg">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="registrarPagoModalLabel">
	                    <i class="fas fa-credit-card me-2"></i>Registrar Pago
	                </h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <div class="modal-body">
	                
	                <!-- Alertas del modal -->
	                <div id="registrarPagoModalAlertContainer"></div>
	                
	                <!-- Resumen del pedido -->
	                <div class="card mb-4">
	                    <div class="card-header">
	                        <h6 class="mb-0"><i class="fas fa-shopping-cart me-2"></i>Resumen del Pedido</h6>
	                    </div>
	                    <div class="card-body">
	                        <div class="row">
	                            <div class="col-md-6">
	                                <p><strong>Cliente:</strong> <span id="pagoClienteNombre">-</span></p>
	                                <p><strong>DNI:</strong> <span id="pagoClienteDni">-</span></p>
	                            </div>
	                            <div class="col-md-6">
	                                <p><strong>Total de productos:</strong> <span id="pagoCantidadProductos">0</span> unidades</p>
	                                <p><strong>Monto total:</strong> <span class="text-primary fs-5"><strong>S/ <span id="pagoMontoTotal">0.00</span></strong></span></p>
	                            </div>
	                        </div>
	                    </div>
	                </div>
	                
	                <!-- Datos del pago -->
	                <div class="card">
	                    <div class="card-header">
	                        <h6 class="mb-0"><i class="fas fa-university me-2"></i>Datos del Pago</h6>
	                    </div>
	                    <div class="card-body">
	                        <div class="row">
	                            <div class="col-md-6">
	                                <div class="mb-3">
	                                    <label for="pagoBanco" class="form-label">Banco <span class="text-danger">*</span></label>
	                                    <select class="form-control" id="pagoBanco" required>
	                                        <option value="">Seleccionar banco...</option>
	                                        <!-- Se llenarán dinámicamente -->
	                                    </select>
	                                </div>
	                            </div>
	                            <div class="col-md-6">
	                                <div class="mb-3">
	                                    <label for="pagoOperacion" class="form-label">Número de Operación <span class="text-danger">*</span></label>
	                                    <input type="text" class="form-control" id="pagoOperacion" 
	                                           placeholder="Ingrese número de operación" required>
	                                </div>
	                            </div>
	                        </div>
	                        
	                        <div class="row">
	                            <div class="col-md-6">
	                                <div class="mb-3">
	                                    <label for="pagoFecha" class="form-label">Fecha de Pago <span class="text-danger">*</span></label>
	                                    <input type="datetime-local" class="form-control" id="pagoFecha" required>
	                                </div>
	                            </div>
	                            <div class="col-md-6">
	                                <div class="mb-3">
	                                    <label for="pagoMonto" class="form-label">Monto Pagado <span class="text-danger">*</span></label>
	                                    <div class="input-group">
	                                        <span class="input-group-text">S/</span>
	                                        <input type="number" class="form-control" id="pagoMonto" 
	                                               step="0.01" min="0" placeholder="0.00" required>
	                                    </div>
	                                </div>
	                            </div>
	                        </div>
	                        
	                        <!-- Estado del pago -->
	                        <div id="estadoPagoRegistro" class="alert alert-warning mt-3">
	                            <i class="fas fa-exclamation-triangle me-2"></i>
	                            <strong>Pago pendiente de registro.</strong> 
	                            Complete todos los campos para registrar el pago.
	                        </div>
	                    </div>
	                </div>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
	                    <i class="fas fa-times me-2"></i>Cancelar
	                </button>
	                <button type="button" class="btn btn-primary" onclick="registrarPago()" id="btnGuardarPago" disabled>
	                    <i class="fas fa-save me-2"></i>Registrar Pago
	                </button>
	            </div>
	        </div>
	    </div>
	</div>
	
	

	<!-- Modal de Confirmación de Pedido Generado -->
	<div class="modal fade" id="confirmacionPedidoModal" tabindex="-1" aria-labelledby="confirmacionPedidoModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered">
	        <div class="modal-content">
	            <div class="modal-header bg-success text-white">
	                <h5 class="modal-title" id="confirmacionPedidoModalLabel">
	                    <i class="fas fa-check-circle me-2"></i>¡Pedido Generado Exitosamente!
	                </h5>
	            </div>
	            <div class="modal-body text-center">
	                <div class="mb-3">
	                    <i class="fas fa-check-circle fa-4x text-success"></i>
	                </div>
	                <h4 class="mb-3">¡Pedido generado exitosamente!</h4>
	                <div class="alert alert-success" role="alert">
	                    <h5 class="alert-heading">Este es su código de pedido:</h5>
	                    <hr>
	                    <h2 class="mb-0" id="codigoPedidoGenerado">-</h2>
	                </div>
	                <p class="text-muted">
	                    Guarde este código para futuras consultas sobre el estado de su pedido.
	                </p>
	            </div>
	            <div class="modal-footer justify-content-center">
	                <button type="button" class="btn btn-success btn-lg" onclick="cerrarConfirmacionPedido()">
	                    <i class="fas fa-thumbs-up me-2"></i>Entendido
	                </button>
	            </div>
	        </div>
	    </div>
	</div>
	
	<!-- Modal de Edición de Orden -->
	<div class="modal fade" id="editarOrdenModal" tabindex="-1" aria-labelledby="editarOrdenModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-xl">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="editarOrdenModalLabel">
	                    <i class="fas fa-edit me-2"></i>Editar Orden de Pedido
	                </h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <div class="modal-body">
	                <!-- Alertas del modal -->
	                <div id="editarModalAlertContainer"></div>
	                
	                <!-- Formulario de edición -->
	                <form id="editarOrdenForm" novalidate>
	                    <input type="hidden" id="editarOrdenId" name="codigo">
	                    
	                    <!-- Información del Cliente -->
	                    <div class="mb-4">
	                        <h6 class="text-muted mb-3">
	                            <i class="fas fa-user me-2"></i>Información del Cliente
	                        </h6>
	                        
	                        <div class="row">
	                            <div class="col-md-4">
	                                <div class="form-group">
	                                    <label for="editarClienteNombre" class="form-label">Nombre del Cliente</label>
	                                    <input type="text" class="form-control bg-light" id="editarClienteNombre" readonly>
	                                    <div class="form-text">Campo de solo lectura</div>
	                                </div>
	                            </div>
	                            <div class="col-md-4">
	                                <div class="form-group">
	                                    <label for="editarClienteDni" class="form-label">DNI</label>
	                                    <input type="text" class="form-control bg-light" id="editarClienteDni" name="cliente.dni" readonly>
	                                    <div class="form-text">Campo de solo lectura</div>
	                                </div>
	                            </div>
	                            <div class="col-md-4">
	                                <div class="form-group">
	                                    <label for="editarClienteCorreo" class="form-label">Correo</label>
	                                    <input type="email" class="form-control bg-light" id="editarClienteCorreo" readonly>
	                                    <div class="form-text">Campo de solo lectura</div>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                    
	                    <!-- Información de la Orden -->
	                    <div class="mb-4">
	                        <h6 class="text-muted mb-3">
	                            <i class="fas fa-shopping-cart me-2"></i>Información de la Orden
	                        </h6>
	                        
	                        <div class="row">
	                            <div class="col-md-4">
	                                <div class="form-group">
	                                    <label for="editarVendedor" class="form-label">Vendedor Asignado</label>
	                                    <input type="text" class="form-control bg-light" id="editarVendedorNombre" readonly>
	                                    <input type="hidden" id="editarVendedor" name="vendedor.codigo">
	                                    <div class="form-text">Campo de solo lectura</div>
	                                </div>
	                            </div>
	                            <div class="col-md-4">
	                                <div class="form-group">
	                                    <label for="editarEstado" class="form-label">Estado</label>
	                                    <select class="form-control" id="editarEstado" name="estado.id" required>
	                                        <option value="">Seleccionar estado...</option>
	                                        <!-- Se llenarán dinámicamente -->
	                                    </select>
	                                </div>
	                            </div>
	                            <div class="col-md-4">
	                                <div class="form-group">
	                                    <label for="editarTecnico" class="form-label">Técnico Asignado</label>
	                                    <input type="text" class="form-control bg-light" id="editarTecnicoNombre" readonly>
	                                    <input type="hidden" id="editarTecnico" name="tecnico.codigo">
	                                    <div class="form-text">Campo de solo lectura</div>
	                                </div>
	                            </div>
	                        </div>
	                        
	                        <div class="row mt-3">
	                            <div class="col-md-6">
	                                <div class="form-group">
	                                    <label for="editarFechaPago" class="form-label">Fecha de Pago</label>
	                                    <input type="text" class="form-control bg-light" id="editarFechaPago" readonly>
	                                    <div class="form-text">Campo de solo lectura</div>
	                                </div>
	                            </div>
	                            <div class="col-md-6">
	                                <div class="form-group">
	                                    <label for="editarTotal" class="form-label">Monto a Pagar</label>
	                                    <input type="text" class="form-control bg-light" id="editarTotal" readonly>
	                                    <div class="form-text">Campo de solo lectura</div>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                    
	                    <!-- Productos de la Orden -->
	                    <div class="mb-4">
	                        <h6 class="text-muted mb-3">
	                            <i class="fas fa-box me-2"></i>Productos de la Orden
	                        </h6>
	                        
	                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
	                            <table class="table table-sm table-bordered">
	                                <thead class="table-light">
	                                    <tr>
	                                        <th>Producto</th>
	                                        <th>Cantidad</th>
	                                        <th>Precio Unitario</th>
	                                        <th>Subtotal</th>
	                                    </tr>
	                                </thead>
	                                <tbody id="editarProductosTable">
	                                    <!-- Se llenarán dinámicamente -->
	                                </tbody>
	                            </table>
	                        </div>
	                        
	                        <div id="noProductosOrden" class="text-center text-muted py-3" style="display: none;">
	                            <i class="fas fa-info-circle me-2"></i>No hay productos en esta orden
	                        </div>
	                    </div>
	                    
	                    <!-- Descripción -->
	                    <div class="mb-4">
	                        <h6 class="text-muted mb-3">
	                            <i class="fas fa-comment me-2"></i>Observaciones
	                        </h6>
	                        
	                        <div class="form-group">
	                            <label for="editarDescripcion" class="form-label">Descripción/Observaciones</label>
	                            <textarea class="form-control" id="editarDescripcion" name="descripcion" rows="3" 
	                                      placeholder="Agregar observaciones sobre la orden..."></textarea>
	                            <div class="form-text">
	                                Campo opcional para observaciones adicionales
	                            </div>
	                        </div>
	                    </div>
	                </form>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
	                    <i class="fas fa-times me-2"></i>Cancelar
	                </button>
	                <button type="button" class="btn btn-primary" onclick="guardarOrdenEditada()" id="btnGuardarOrden">
	                    <i class="fas fa-save me-2"></i>Guardar Cambios
	                </button>
	            </div>
	        </div>
	    </div>
	</div>
	
    <!-- Modal de Asignación de Técnico -->
    <div class="modal fade" id="asignarModal" tabindex="-1" aria-labelledby="asignarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="asignarModalLabel">
                        <i class="fas fa-user-check me-2"></i>Asignar Técnico a Pedidos
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Alertas del modal -->
                    <div id="modalAlertContainer"></div>
                    
                    <!-- Búsqueda de Técnico -->
                    <div class="mb-4">
                        <h6 class="text-muted mb-3">
                            <i class="fas fa-search me-2"></i>Buscar Técnico
                        </h6>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Buscar por Código:</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="tecnicoCodigoInput" placeholder="Código del técnico">
                                    <button class="btn btn-outline-secondary" type="button" onclick="buscarTecnicoPorCodigo()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">O seleccionar de la lista:</label>
                                <select class="form-control" id="tecnicoSelect">
                                    <option value="">Seleccionar técnico...</option>
                                    <!-- Se llenarán dinámicamente -->
                                </select>
                            </div>
                        </div>
                        
                        <!-- Información del técnico seleccionado -->
                        <div id="tecnicoInfo" class="mt-3" style="display: none;">
                            <div class="alert alert-info">
                                <i class="fas fa-user me-2"></i>
                                <strong>Técnico seleccionado:</strong> <span id="tecnicoNombre"></span>
                                <br><strong>DNI:</strong> <span id="tecnicoDni"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Órdenes Pendientes -->
                    <div class="mb-4">
                        <h6 class="text-muted mb-3">
                            <i class="fas fa-list me-2"></i>Órdenes Pendientes para Asignar
                        </h6>
                        
                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                            <table class="table table-sm table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th width="10%">
                                            <input type="checkbox" id="selectAllOrdenes" onclick="toggleAllOrdenes()">
                                        </th>
                                        <th>Código</th>
                                        <th>Cliente</th>
                                        <th>Fecha</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="ordenesPendientesTable">
                                    <!-- Se llenarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="noOrdenesPendientes" class="text-center text-muted py-3" style="display: none;">
                            <i class="fas fa-info-circle me-2"></i>No hay órdenes pendientes para asignar
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="asignarTecnico()" id="btnAsignar" disabled>
                        <i class="fas fa-user-check me-2"></i>Asignar Técnico
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Include Footer -->
    <div th:replace="~{footer :: footer}"></div>

	<!-- Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<!-- Script de búsqueda mejorada -->
	<!-- Orden de pedido -->
	<script th:src="@{/js/ordenPedido.js}"></script>
	<!-- Modal Asignar JS -->
	<script th:src="@{/js/modalAsignar.js}"></script>
	<!-- Modal Editar Orden JS -->
	<script th:src="@{/js/modalEditarOrden.js}"></script>
	<!-- Modal Editar Orden JS -->
	<script th:src="@{/js/modalGenerarPedido.js}"></script>

	</body>
	</html>